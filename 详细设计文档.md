# 饮水记录与健康提醒应用 - 详细设计文档

## 1. 引言

### 1.1 文档目的
本文档详细描述饮水记录与健康提醒应用的实现细节，包括模块设计、函数实现、接口定义、数据流程等内容，为开发和测试提供详细指导。

### 1.2 文档范围
覆盖应用的所有功能模块和实现细节，包括：
- 页面结构设计
- 样式实现细节
- 核心功能函数设计
- 数据流程和处理逻辑

## 2. 页面结构设计

### 2.1 HTML结构

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>饮水记录与健康提醒</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,...">
</head>
<body>
    <div class="container">
        <!-- 顶部标题与设置 -->
        <header>
            <h1>饮水记录与健康提醒</h1>
            <button id="settings-btn" title="设置">Settings</button>
        </header>

        <!-- 水杯动画 -->
        <div class="water-section">
            <div class="water-cup" id="cup">
                <div class="water" id="water">
                    <div class="amount-text" id="amount-text">0 ml</div>
                </div>
                <div class="wave"></div>
                <div class="wave" style="animation-delay: -2s; opacity: 0.6;"></div>
            </div>
            <div class="progress-text">
                今日进度 <span id="percent">0</span>% · 已饮 <span id="today">0</span> ml
            </div>
        </div>

        <!-- 统计卡片 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="label">今日目标</div>
                <div class="value" id="goal">2000</div>
                <div class="unit">ml</div>
            </div>
            <div class="stat-card highlight">
                <div class="label">连续打卡</div>
                <div class="value" id="streak">0</div>
                <div class="unit">天</div>
            </div>
            <div class="stat-card">
                <div class="label">本周平均</div>
                <div class="value" id="week-avg">0</div>
                <div class="unit">ml</div>
            </div>
        </div>

        <!-- 加水按钮区 -->
        <div class="buttons">
            <button onclick="addWater(150)">+150ml<br><small>小杯茶</small></button>
            <button onclick="addWater(250)">+250ml<br><small>标准杯</small></button>
            <button onclick="addWater(500)">+500ml<br><small>大瓶水</small></button>
            <button onclick="customAdd()" class="custom-btn">自定义</button>
        </div>

        <!-- 健康提醒区域 -->
        <div class="reminder-section">
            <h3>健康喝水小贴士</h3>
            <div class="tip-card" id="tip-card">...</div>
            <button onclick="getRandomTip()" class="tip-btn">换一条提醒</button>
        </div>

        <!-- 功能按钮 -->
        <div class="actions">
            <button onclick="showHistory()" class="secondary">查看7天记录</button>
            <button id="reset-btn" class="danger">长按重置当天</button>
        </div>
    </div>

    <!-- 设置弹窗 -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <h3>每日喝水目标（ml）</h3>
            <input type="number" id="new-goal" min="1000" max="5000" step="100" value="2000">
            <div class="modal-buttons">
                <button onclick="saveGoal()">保存</button>
                <button onclick="closeModal()">取消</button>
            </div>
        </div>
    </div>

    <script src="js/script.js"></script>
</body>
</html>
```

## 3. 样式实现设计

### 3.1 核心样式设计

#### 3.1.1 整体布局
- 使用Flexbox实现页面居中
- 应用渐变背景和毛玻璃效果
- 响应式设计，适配不同屏幕尺寸

#### 3.1.2 水杯动画
- 使用CSS border-radius实现水杯形状
- 动态调整water元素的height属性实现水位变化
- 使用CSS动画实现波浪效果

#### 3.1.3 统计卡片
- 使用Grid布局实现卡片排列
- 突出显示连续打卡卡片
- 响应式调整，在移动端变为两列布局

#### 3.1.4 按钮样式
- 应用渐变背景和阴影效果
- 悬停时实现上浮动画
- 自定义按钮特殊样式

### 3.2 关键CSS代码

#### 3.2.1 水杯样式
```css
.water-cup {
    width: 220px;
    height: 280px;
    margin: 0 auto 20px;
    background: #e1f5fe;
    border-radius: 0 0 110px 110px;
    position: relative;
    overflow: hidden;
    border: 8px solid #81d4fa;
    box-shadow: inset 0 10px 30px rgba(0,0,0,0.15);
}

.water {
    position: absolute; bottom: 0; left: 0; right: 0;
    height: 0%;
    background: linear-gradient(to top, #1976d2, #42a5f5);
    transition: height 1.2s cubic-bezier(0.4, 0, 0.2, 1);
}
```

#### 3.2.2 波浪动画
```css
.wave {
    position: absolute; top: -70px; width: 320px; height: 100px;
    background: rgba(255,255,255,0.4);
    border-radius: 45%;
    animation: wave 6s linear infinite;
}

@keyframes wave {
    0%   { transform: translateX(0) rotate(0deg); }
    100% { transform: translateX(-160px) rotate(8deg); }
}
```

## 4. 核心功能实现

### 4.1 初始化功能

#### 4.1.1 window.onload
- **功能**：页面加载完成后初始化应用
- **实现**：
  ```javascript
  window.onload = () => {
      loadAllData();
      updateAllDisplay();
      startRemindTimer();
      setupButtons();
      getRandomTip();
  };
  ```

#### 4.1.2 loadAllData()
- **功能**：加载所有配置和数据
- **实现**：
  ```javascript
  function loadAllData() {
      // 喝水记录
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) data = JSON.parse(saved);

      // 目标
      const goal = localStorage.getItem("dailyGoal");
      if (goal) {
          DAILY_GOAL = Number(goal);
          document.getElementById("goal").textContent = DAILY_GOAL;
      }
  }
  ```

### 4.2 饮水记录功能

#### 4.2.1 addWater(ml)
- **功能**：添加饮水量记录
- **参数**：
  - ml：数值，饮水量（毫升）
- **实现**：
  ```javascript
  function addWater(ml) {
      const today = getToday();
      if (!data.records[today]) data.records[today] = 0;
      data.records[today] += ml;
      saveData();
      updateAllDisplay();
  }
  ```

#### 4.2.2 customAdd()
- **功能**：自定义添加饮水量
- **实现**：
  ```javascript
  function customAdd() {
      const input = prompt("请输入喝水量（ml）", "350");
      if (input && !isNaN(input)) {
          const num = Number(input);
          if (num > 0) addWater(num);
      }
  }
  ```

### 4.3 界面更新功能

#### 4.3.1 updateAllDisplay()
- **功能**：更新所有页面显示
- **实现**：
  ```javascript
  function updateAllDisplay() {
      const today = getToday();
      const amount = data.records[today] || 0;
      const percent = Math.min(100, Math.round(amount / DAILY_GOAL * 100));

      document.getElementById("today").textContent = amount;
      document.getElementById("percent").textContent = percent;
      document.getElementById("amount-text").textContent = amount + " ml";
      document.getElementById("water").style.height = percent + "%";

      updateStreak();
      updateWeekAvg();
  }
  ```

#### 4.3.2 updateStreak()
- **功能**：更新连续打卡天数
- **实现**：
  ```javascript
  function updateStreak() {
      let streak = 0;
      let check = new Date();
      while (true) {
          const key = check.toISOString().slice(0,10);
          if (data.records[key] && data.records[key] >= MIN_FOR_STREAK) {
              streak++;
              check.setDate(check.getDate() - 1);
          } else break;
      }
      document.getElementById("streak").textContent = streak;
  }
  ```

#### 4.3.3 updateWeekAvg()
- **功能**：更新本周平均饮水量
- **实现**：
  ```javascript
  function updateWeekAvg() {
      let total = 0;
      let count = 0;
      for (let i = 0; i < 7; i++) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          const key = date.toISOString().slice(0,10);
          if (data.records[key]) {
              total += data.records[key];
              count++;
          }
      }
      const avg = count > 0 ? Math.round(total / count) : 0;
      document.getElementById("week-avg").textContent = avg;
  }
  ```

### 4.4 健康提醒功能

#### 4.4.1 getRandomTip()
- **功能**：获取随机健康小贴士
- **返回值**：字符串，健康小贴士内容
- **实现**：
  ```javascript
  function getRandomTip() {
      const tip = HEALTH_TIPS[Math.floor(Math.random() * HEALTH_TIPS.length)];
      document.getElementById("tip-card").textContent = "Tip: " + tip;
      return tip;
  }
  ```

#### 4.4.2 startRemindTimer()
- **功能**：启动定时提醒
- **实现**：
  ```javascript
  function startRemindTimer() {
      setInterval(() => {
          if (document.hasFocus() && Date.now() - data.lastRemind > 10000) {
              const today = getToday();
              if ((!data.records[today] || data.records[today] < DAILY_GOAL * 0.6)) {
                  if (confirm("已经45分钟没喝水啦！\n\n" + getRandomTip().replace("Tip: ", "") + "\n\n现在喝一杯吗？")) {
                      addWater(250);
                  }
              }
              data.lastRemind = Date.now();
              saveData();
          }
      }, REMIND_INTERVAL);
  }
  ```

### 4.5 其他功能

#### 4.5.1 setupButtons()
- **功能**：设置按钮事件
- **实现**：
  ```javascript
  function setupButtons() {
      // 长按重置当天记录
      const resetBtn = document.getElementById("reset-btn");
      let timer;
      resetBtn.onmousedown = resetBtn.ontouchstart = () => {
          timer = setTimeout(() => {
              if (confirm("确定要重置今天的饮水记录吗？")) {
                  delete data.records[getToday()];
                  saveData();
                  updateAllDisplay();
                  alert("已重置当天记录");
              }
          }, 2000);
          resetBtn.textContent = "松手取消...";
          resetBtn.style.background = "#d32f2f";
      };
      // 取消长按
      resetBtn.onmouseup = resetBtn.onmouseleave = resetBtn.ontouchend = () => {
          clearTimeout(timer);
          resetBtn.textContent = "长按重置当天";
          resetBtn.style.background = "#ff5252";
      };

      // 设置按钮
      document.getElementById("settings-btn").onclick = () => {
          document.getElementById("settings-modal").style.display = "flex";
          document.getElementById("new-goal").value = DAILY_GOAL;
      };
  }
  ```

#### 4.5.2 saveGoal()
- **功能**：保存每日目标
- **实现**：
  ```javascript
  function saveGoal() {
      const val = document.getElementById("new-goal").value;
      if (val >= 1000 && val <= 5000) {
          DAILY_GOAL = Number(val);
          localStorage.setItem("dailyGoal", DAILY_GOAL);
          document.getElementById("goal").textContent = DAILY_GOAL;
          updateAllDisplay();
          closeModal();
      } else alert("目标范围：1000~5000ml");
  }
  ```

#### 4.5.3 showHistory()
- **功能**：显示近7天饮水历史
- **实现**：
  ```javascript
  function showHistory() {
      let msg = "近7天饮水记录：\n\n";
      for (let i = 0; i < 7; i++) {
          const d = new Date();
          d.setDate(d.getDate() - i);
          const key = d.toISOString().slice(0,10);
          const amt = data.records[key] || 0;
          const day = d.toLocaleDateString("zh-CN", {month:"numeric", day:"numeric"});
          msg += `${day}（${["日","一","二","三","四","五","六"][d.getDay()]}） ${amt}ml ${amt >= MIN_FOR_STREAK ? "Success" : ""}\n`;
      }
      alert(msg);
  }
  ```

## 5. 数据流程设计

### 5.1 数据存储流程

```
用户操作 → 数据更新 → 调用saveData() → localStorage.setItem(STORAGE_KEY, JSON.stringify(data))
```

### 5.2 数据读取流程

```
页面加载 → 调用loadAllData() → localStorage.getItem(STORAGE_KEY) → JSON.parse() → 更新data对象
```

### 5.3 数据处理流程

```
data对象更新 → 调用updateAllDisplay() → 更新DOM元素 → 页面显示更新
```

## 6. 异常处理设计

### 6.1 输入验证
- 自定义饮水量输入进行数值验证
- 目标设置限制在1000-5000ml范围内
- 非数字输入提示错误

### 6.2 数据安全
- 使用try-catch处理JSON解析异常
- 对localStorage操作进行错误处理
- 确保数据始终为有效格式

### 6.3 边界情况处理
- 首次使用时初始化空数据结构
- 历史记录为空时显示默认值
- 连续打卡天数为0时正常显示

## 7. 测试设计

### 7.1 功能测试用例

| 测试项 | 测试步骤 | 预期结果 |
|--------|----------|----------|
| 饮水记录 | 点击+250ml按钮 | 饮水量增加250ml，界面更新 |
| 自定义饮水 | 输入500，点击确定 | 饮水量增加500ml，界面更新 |
| 目标设置 | 设置为3000ml | 目标值更新为3000ml，界面更新 |
| 连续打卡 | 模拟连续3天有效记录 | 连续打卡显示3天 |
| 健康提醒 | 等待45分钟或手动触发 | 弹出提醒对话框 |
| 历史记录 | 点击查看7天记录 | 显示近7天详细记录 |

### 7.2 边界测试用例

| 测试项 | 测试步骤 | 预期结果 |
|--------|----------|----------|
| 最小饮水量 | 输入0.5ml | 不允许，提示错误 |
| 最大目标值 | 设置为6000ml | 不允许，提示错误 |
| 最小目标值 | 设置为900ml | 不允许，提示错误 |
| 首次使用 | 清除所有数据后打开 | 显示默认值，无错误 |

## 8. 性能优化设计

### 8.1 动画性能
- 使用CSS transform和opacity属性进行动画
- 避免频繁重排重绘
- 使用requestAnimationFrame优化动画

### 8.2 数据处理性能
- 减少localStorage操作次数
- 批量更新数据
- 合理使用缓存

### 8.3 资源优化
- 优化CSS和JavaScript代码
- 减少不必要的DOM操作
- 合理使用事件委托

## 9. 结论

本文档详细描述了饮水记录与健康提醒应用的实现细节，包括页面结构、样式设计、核心功能实现、数据流程等内容。应用采用前端单页架构，无需后端服务器，所有数据存储在浏览器本地，具有良好的性能和用户体验。应用实现了饮水记录、进度展示、数据统计、健康提醒等核心功能，并支持目标设置、历史记录查看等辅助功能。通过合理的设计和实现，应用具有良好的可扩展性和可维护性，能够满足用户的健康饮水管理需求。