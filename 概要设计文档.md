# 饮水记录与健康提醒应用 - 概要设计文档

## 1. 引言

### 1.1 文档目的
本文档描述饮水记录与健康提醒应用的概要设计，包括系统架构、模块划分、核心功能流程、数据结构设计等内容，为详细设计和开发实现提供指导。

### 1.2 术语定义
| 术语 | 解释 |
|------|------|
| 饮水记录 | 用户每次喝水的记录，包括日期和饮水量 |
| 连续打卡 | 每日饮水量≥1000ml视为有效打卡，连续有效打卡的天数 |
| 饮水目标 | 用户设置的每日目标饮水量 |
| 本地存储 | 浏览器提供的localStorage机制，用于持久化存储数据 |

## 2. 系统架构设计

### 2.1 总体架构
本应用采用前端单页应用架构，无需后端服务器，所有数据存储在浏览器本地。系统主要分为三个层次：

1. **界面层**：负责用户交互和数据展示
2. **业务逻辑层**：处理核心业务逻辑
3. **数据层**：负责数据的存储和读取

### 2.2 系统模块划分

| 模块 | 主要功能 | 对应文件 |
|------|----------|----------|
| 界面渲染模块 | 负责页面布局和元素渲染 | index.html |
| 样式管理模块 | 负责页面样式和动画效果 | css/style.css |
| 核心功能模块 | 处理饮水记录、数据统计等核心业务逻辑 | js/script.js |
| 健康提醒模块 | 提供健康小贴士和定时提醒功能 | js/script.js |
| 数据存储模块 | 负责数据的本地存储和读取 | js/script.js |

## 3. 核心功能设计

### 3.1 饮水记录流程

```
用户点击饮水按钮 → 调用addWater()函数 → 更新本地存储 → 调用updateAllDisplay() → 更新页面显示
```

### 3.2 数据统计流程

```
页面加载/数据更新 → 调用updateAllDisplay() → 分别调用：
  - updateStreak()：计算连续打卡天数
  - updateWeekAvg()：计算本周平均饮水量
→ 更新页面统计数据
```

### 3.3 健康提醒流程

```
定时触发（45分钟） → 检查用户活跃状态和饮水进度 → 弹出提醒对话框 → 用户确认后调用addWater()
```

### 3.4 目标设置流程

```
用户点击设置按钮 → 打开设置弹窗 → 用户输入新目标 → 点击保存 → 更新本地存储 → 更新页面显示
```

## 4. 数据结构设计

### 4.1 配置常量

| 常量名 | 类型 | 默认值 | 描述 |
|--------|------|--------|------|
| STORAGE_KEY | 字符串 | "waterPro2025" | 本地存储的键名 |
| DAILY_GOAL | 数值 | 2000 | 每日目标饮水量（ml） |
| MIN_FOR_STREAK | 数值 | 1000 | 有效打卡的最小饮水量（ml） |
| REMIND_INTERVAL | 数值 | 45*60*1000 | 提醒间隔（毫秒） |

### 4.2 健康提醒内容库

```javascript
const HEALTH_TIPS = [
  "早晨空腹喝一杯温水，能唤醒身体、促进代谢",
  // 更多健康小贴士...
];
```

### 4.3 数据存储结构

```javascript
{
  records: {
    "2025-01-01": 1500,  // 日期 → 饮水量（ml）
    "2025-01-02": 2000
  },
  lastRemind: 1735689600000  // 最后提醒时间戳
}
```

## 5. 界面设计

### 5.1 页面布局

1. **顶部区域**：标题和设置按钮
2. **水杯区域**：动态水杯动画和进度显示
3. **统计卡片区域**：显示目标、连续打卡、本周平均
4. **饮水按钮区域**：预设和自定义饮水按钮
5. **健康提醒区域**：健康小贴士和切换按钮
6. **功能按钮区域**：历史记录和重置按钮
7. **设置弹窗**：目标设置界面

### 5.2 响应式设计

- **桌面端**：完整布局，三列统计卡片
- **移动端**：适配小屏幕，两列统计卡片，突出显示连续打卡卡片

## 6. 技术实现要点

### 6.1 动态效果实现
- 水杯水位动画：使用CSS transition实现平滑过渡
- 波浪效果：使用CSS animation实现连续波浪动画
- 按钮交互：使用CSS transform和box-shadow实现悬停效果

### 6.2 本地存储实现
- 使用localStorage API进行数据持久化
- 数据格式为JSON，便于解析和处理
- 数据自动保存，无需手动操作

### 6.3 定时提醒实现
- 使用setInterval设置定时任务
- 检查用户活跃状态，避免干扰用户
- 结合健康小贴士，提高提醒的实用性

### 6.4 连续打卡算法
- 从当天开始，向前遍历历史记录
- 累计连续有效打卡天数（每日饮水量≥1000ml）
- 遇到无效记录则停止计算

## 7. 系统安全性设计

### 7.1 数据安全
- 所有数据存储在用户本地，不涉及服务器传输
- 数据仅用于用户个人记录，不进行任何分析或共享

### 7.2 输入验证
- 自定义饮水量输入进行数值验证
- 目标设置限制在合理范围内（1000-5000ml）

## 8. 系统扩展性设计

### 8.1 功能扩展
- 健康提醒内容库支持动态添加
- 可扩展更多饮水建议和健康知识
- 支持添加更多统计维度（如月度统计、年度统计）

### 8.2 技术扩展
- 可集成推送通知API，提高提醒效果
- 可扩展数据同步功能，支持多设备数据共享
- 可添加数据导出功能，支持导出到CSV等格式

## 9. 测试策略

### 9.1 功能测试
- 测试所有核心功能的正常运行
- 测试边界条件和异常情况
- 测试数据持久化功能

### 9.2 界面测试
- 测试不同设备和浏览器的兼容性
- 测试响应式设计的适配效果
- 测试动画效果的流畅性

### 9.3 性能测试
- 测试页面加载速度
- 测试数据更新响应时间
- 测试长时间运行的稳定性

## 10. 部署与维护

### 10.1 部署方式
- 静态文件部署，无需服务器
- 支持部署到任何静态网站托管服务
- 支持本地直接打开运行

### 10.2 维护策略
- 定期更新健康提醒内容
- 修复浏览器兼容性问题
- 优化性能和用户体验

## 11. 结论

本概要设计文档描述了饮水记录与健康提醒应用的核心架构和功能设计，为详细设计和开发实现提供了指导。应用采用前端单页架构，无需后端服务器，具有功能完整、易于部署、用户体验良好等特点。通过合理的模块划分和数据结构设计，确保了系统的可扩展性和可维护性。